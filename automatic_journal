#!/bin/bash

set -euo pipefail

if [[ $# -ne 1 ]]; then
    echo "Usage automatic_journal <yyyy-mm-dd>" >&2
    exit 1
fi

dir=$(dirname "$(readlink -f "$0")")
cd "$dir"  # This is where the Pipfile is.
date=$1

for provider_dir in "providers"/*; do
    echo "=== Running $provider_dir ===" >&2
    if [[ -f "$provider_dir/main" ]]; then
        "$provider_dir/main" "$date"
    elif [[ -f "$provider_dir/main.py" ]]; then
        pipenv run "$provider_dir/main.py"
    else
        echo "No main script found" >&2
    fi
done
