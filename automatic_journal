#!/bin/bash

set -euo pipefail

if [[ $# -ne 1 ]]; then
    echo "Usage automatic_journal <yyyy-mm-dd>" >&2
    exit 1
fi

dir=$(dirname "$(readlink -f "$0")")
date=$1
path_out="$dir/results/journal-$date-$(date +%s).csv"
mkdir -p "$(dirname "$path_out")"

for provider_main in "$dir/providers"/*/main.sh; do
    echo "=== Running $provider_main ===" >&2
    "$provider_main" "$date" >> "$path_out"
done
